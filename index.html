<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   <link href="
https://cdn.jsdelivr.net/npm/tailwindcss@4.1.11/index.min.css
" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>Horario - La Comarc√≥n</title>
    <style>
        .favorite-btn {
            cursor: pointer;
            font-size: 1.5rem;
            color: #ccc;
            transition: color 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .favorite-btn.is-favorite {
            color: #FFD700;
        }
        .detalle-actividad {
            display: none;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: #555;
            background-color: #f9fafb;
            padding: 0.75rem 1rem;
            border-radius: 0.375rem;
            border: 1px solid #e5e7eb;
        }
        .actividad:hover {
            cursor: pointer;
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">
    <div class="max-w-md mx-auto p-4">
        <div class="text-center mb-4">
            <h1 class="text-2xl font-bold">Horario - La Comarc√≥n</h1>
            <p class="text-sm text-gray-600">Torrevieja ¬∑ 2025</p>
        </div>

        <div class="flex justify-center mb-4">
            <button id="dia1Btn" class="px-4 py-2 bg-blue-500 text-white rounded-l-lg">S√°bado</button>
            <button id="dia2Btn" class="px-4 py-2 bg-blue-100 text-blue-700 rounded-r-lg">Domingo</button>
        </div>

        <div class="flex overflow-x-auto mb-4 space-x-2">
            <button onclick="setFiltro('todas')" class="filtro-btn px-3 py-1 rounded-full bg-gray-200 text-gray-800">Todas</button>
            <button onclick="setFiltro('favoritos')" class="filtro-btn px-3 py-1 rounded-full bg-yellow-200 text-yellow-800">‚≠ê Favoritos</button>
            <button onclick="setFiltro('rol_mesa')" class="filtro-btn px-3 py-1 rounded-full bg-purple-100 text-purple-700">Rol de mesa</button>
            <button onclick="setFiltro('rol_vivo')" class="filtro-btn px-3 py-1 rounded-full bg-pink-100 text-pink-700">Rol en vivo</button>
            <button onclick="setFiltro('videojuegos')" class="filtro-btn px-3 py-1 rounded-full bg-blue-100 text-blue-700">Videojuegos</button>
            <button onclick="setFiltro('juegos_mesa')" class="filtro-btn px-3 py-1 rounded-full bg-indigo-100 text-indigo-700">Juegos de mesa</button>
            <button onclick="setFiltro('deportes')" class="filtro-btn px-3 py-1 rounded-full bg-yellow-100 text-yellow-700">Deportes</button>
            <button onclick="setFiltro('concursos')" class="filtro-btn px-3 py-1 rounded-full bg-red-100 text-red-700">Concursos</button>
            <button onclick="setFiltro('talleres')" class="filtro-btn px-3 py-1 rounded-full bg-green-100 text-green-700">Talleres</button>
            <button onclick="setFiltro('charlas')" class="filtro-btn px-3 py-1 rounded-full bg-orange-100 text-orange-700">Charlas</button>
            <button onclick="setFiltro('otros')" class="filtro-btn px-3 py-1 rounded-full bg-gray-300 text-gray-800">Otros</button>
        </div>

        <div id="horario" class="space-y-4"></div>
    </div>

    <script>
        let actividades = { sabado: [], domingo: [] };
        let diaActual = "sabado";
        let filtroActual = "todas";
        let favoritos = new Set(JSON.parse(localStorage.getItem('horarioFavoritos')) || []);

        const URL_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQVrAqpQlI4uhoa45UBxoRxsrnUB54QJ_LR5WgScbfFEGwkUannAa-0jRONdjsOwRoJ2hYNbMMAqcw-/pub?output=csv";

        function agruparPorHora(lista) {
            const mapa = {};
            lista.forEach(act => {
                if (filtroActual === "favoritos" && !favoritos.has(act.id)) return;
                if (filtroActual !== "todas" && filtroActual !== "favoritos" && act.tipo !== filtroActual) return;
                if (!mapa[act.hora]) mapa[act.hora] = [];
                mapa[act.hora].push(act);
            });
            return mapa;
        }

        function renderHorario() {
            const contenedor = document.getElementById("horario");
            contenedor.innerHTML = "";
            const actividadesPorHora = agruparPorHora(actividades[diaActual]);
            const horas = Object.keys(actividadesPorHora).sort();

            if (horas.length === 0) {
                contenedor.innerHTML = "<p class='text-center text-gray-500'>No hay actividades para esta selecci√≥n.</p>";
                return;
            }

            horas.forEach(hora => {
                const bloque = document.createElement("div");
                bloque.innerHTML = `<h3 class="text-sm font-semibold text-gray-600 mb-2">üïí ${hora}</h3>`;
                actividadesPorHora[hora].forEach(act => {
                    const card = document.createElement("div");
                    card.className = "bg-white p-4 mb-2 rounded shadow flex justify-between items-center actividad";

                    const isFavoriteClass = favoritos.has(act.id) ? 'is-favorite' : '';
                    const starIconClass = favoritos.has(act.id) ? 'fas' : 'far';

                    card.innerHTML = `
                        <div>
                            <h2 class="text-lg font-bold">${act.titulo}</h2>
                            <span class="inline-block mt-1 px-2 py-1 text-xs rounded-full ${getColor(act.tipo)}">${formateaCategoria(act.tipo)}</span>
                            <div class="detalle-actividad">
                                ${act.detalle || 'No hay informaci√≥n adicional.'}
                                ${act.enlace ? `<div class="mt-2"><a href="${act.enlace}" target="_blank" class="text-blue-600 underline font-semibold">Apuntarse / M√°s info</a></div>` : ''}
                            </div>
                        </div>
                        <div class="flex items-center">
                            <div class="text-sm text-gray-500 ml-4 whitespace-nowrap mr-2">‚è± ${act.duracion}</div>
                            <span class="favorite-btn ${isFavoriteClass}" data-id="${act.id}">
                                <i class="${starIconClass} fa-star"></i>
                            </span>
                        </div>
                    `;
                    card.addEventListener('click', (e) => {
                        if (e.target.closest('.favorite-btn')) return;
                        const detalle = card.querySelector('.detalle-actividad');
                        detalle.style.display = (detalle.style.display === 'block') ? 'none' : 'block';
                    });
                    bloque.appendChild(card);
                });
                contenedor.appendChild(bloque);
            });

            document.querySelectorAll('.favorite-btn').forEach(button => {
                button.addEventListener('click', toggleFavorite);
            });
        }

        function formateaCategoria(tipo) {
            const mapa = {
                rol_mesa: "Rol de mesa", rol_vivo: "Rol en vivo", videojuegos: "Videojuegos",
                juegos_mesa: "Juegos de mesa", deportes: "Deportes", concursos: "Concursos",
                talleres: "Talleres", charlas: "Charlas", otros: "Otros", favoritos: "Favoritos"
            };
            return mapa[tipo] || tipo;
        }

        function getColor(tipo) {
            switch (tipo) {
                case "rol_mesa": return "bg-purple-100 text-purple-700";
                case "rol_vivo": return "bg-pink-100 text-pink-700";
                case "videojuegos": return "bg-blue-100 text-blue-700";
                case "juegos_mesa": return "bg-indigo-100 text-indigo-700";
                case "deportes": return "bg-yellow-100 text-yellow-700";
                case "concursos": return "bg-red-100 text-red-700";
                case "talleres": return "bg-green-100 text-green-700";
                case "charlas": return "bg-orange-100 text-orange-700";
                case "otros": return "bg-gray-200 text-gray-800";
                default: return "bg-gray-100 text-gray-700";
            }
        }

        function toggleFavorite(event) {
            const button = event.currentTarget;
            const icon = button.querySelector('i');
            const id = button.dataset.id;
            if (favoritos.has(id)) {
                favoritos.delete(id);
                button.classList.remove('is-favorite');
                icon.classList.remove('fas');
                icon.classList.add('far');
            } else {
                favoritos.add(id);
                button.classList.add('is-favorite');
                icon.classList.remove('far');
                icon.classList.add('fas');
            }
            localStorage.setItem('horarioFavoritos', JSON.stringify(Array.from(favoritos)));
            if (filtroActual === "favoritos") renderHorario();
        }

        function setFiltro(filtro) {
            filtroActual = filtro;
            document.querySelectorAll(".filtro-btn").forEach(btn => {
                btn.classList.remove("ring", "ring-offset-2", "ring-blue-500");
            });
            const btnActivo = Array.from(document.querySelectorAll(".filtro-btn"))
                .find(btn => btn.textContent.toLowerCase().includes(formateaCategoria(filtro).toLowerCase()));
            if (btnActivo) btnActivo.classList.add("ring", "ring-offset-2", "ring-blue-500");
            renderHorario();
        }

        function parseCSV(text) {
            const lines = text.trim().split("\n");
            const headers = lines[0].split(",").map(h => h.trim());
            return lines.slice(1).map(row => {
                const values = row.split(",").map(c => c.trim());
                const obj = {};
                headers.forEach((h, i) => obj[h] = values[i]);
                return obj;
            });
        }

        function cargarDesdeCSV() {
            fetch(URL_CSV)
                .then(resp => resp.text())
                .then(data => {
                    const registros = parseCSV(data);
                    actividades = { sabado: [], domingo: [] };
                    registros.forEach(r => {
                        if (r["id"] && r["hora"] && r["titulo"] && r["tipo"] && r["duracion"] && r["dia"]) {
                            const actividad = {
                                id: r["id"].trim(),
                                hora: r["hora"].trim(),
                                titulo: r["titulo"].trim(),
                                tipo: r["tipo"].toLowerCase().trim(),
                                duracion: r["duracion"].trim(),
                                detalle: r["detalle"]?.trim() || "",
                                enlace: r["enlace"]?.trim() || ""
                            };
                            const dia = r["dia"].toLowerCase();
                            if (dia.includes("sab")) actividades.sabado.push(actividad);
                            else if (dia.includes("dom")) actividades.domingo.push(actividad);
                        }
                    });
                    renderHorario();
                });
        }

        document.getElementById("dia1Btn").addEventListener("click", () => {
            diaActual = "sabado";
            document.getElementById("dia1Btn").classList.add("bg-blue-500", "text-white");
            document.getElementById("dia1Btn").classList.remove("bg-blue-100", "text-blue-700");
            document.getElementById("dia2Btn").classList.remove("bg-blue-500", "text-white");
            document.getElementById("dia2Btn").classList.add("bg-blue-100", "text-blue-700");
            renderHorario();
        });

        document.getElementById("dia2Btn").addEventListener("click", () => {
            diaActual = "domingo";
            document.getElementById("dia2Btn").classList.add("bg-blue-500", "text-white");
            document.getElementById("dia2Btn").classList.remove("bg-blue-100", "text-blue-700");
            document.getElementById("dia1Btn").classList.remove("bg-blue-500", "text-white");
            document.getElementById("dia1Btn").classList.add("bg-blue-100", "text-blue-700");
            renderHorario();
        });

        cargarDesdeCSV();
    </script>
</body>
</html>



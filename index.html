<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>Horario - La Comarcón</title>
    <style>
        /* Aplicar el color de fondo a todo el body */
        body {
            background-color: #990099; /* Morado de la captura */
        }

        /* Aplicar la fuente Permanent Marker al título h1 */
        h1 {
            font-family: 'Permanent Marker', cursive;
            color: #ecf0f1; /* Un color claro para que resalte sobre el morado */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); /* Sombra para mejor legibilidad */
        }

        /* Estilos para la imagen del logo */
        .logo-img {
            height: 50px; /* Ajusta el tamaño según necesites */
            width: auto; /* Mantiene la proporción */
        }

        .favorite-btn {
            cursor: pointer;
            font-size: 1.5rem;
            color: #ccc;
            transition: color 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .favorite-btn.is-favorite {
            color: #FFD700;
        }
        .detalle-actividad {
            display: none;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: #555;
            background-color: #f9fafb;
            padding: 0.75rem 1rem;
            border-radius: 0.375rem;
            border: 1px solid #e5e7eb;
        }
        .actividad:hover {
            cursor: pointer;
            background-color: #f3f4f6;
        }
        /* Estilo para el icono de navegación (mapa/calendario) */
        .nav-icon {
            font-size: 2.2rem; /* Tamaño del icono */
            color: #ecf0f1; /* Color claro para que resalte */
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3); /* Sombra para mejor legibilidad */
            cursor: pointer;
            transition: color 0.2s;
        }
        .nav-icon:hover {
            color: #FFD700; /* Color al pasar el ratón */
        }
        /* Estilo para el contenedor del mapa */
        #mapa-container {
            display: none; /* Inicialmente oculto */
            background-color: #f9fafb; /* Fondo claro */
            border-radius: 0.375rem;
            padding: 1rem;
            /* Eliminamos min-height y flex-direction para que el SVG controle el tamaño */
            color: #555;
            text-align: center;
            /* Añadimos un flex-grow para que ocupe el espacio si es necesario, pero el SVG es intrínseco */
            flex-grow: 1; 
            overflow: hidden; /* Para que el SVG no se desborde si tiene un viewBox grande */
        }
        /* Estilos específicos para el SVG */
        #evento-mapa-svg {
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            width: 100%; /* El SVG se ajustará al ancho de su contenedor */
            height: auto; /* Mantiene la proporción */
            display: block; /* Elimina espacio extra bajo el SVG */
            max-width: 100%; /* Asegura que no se desborde */
            margin: 0 auto; /* Centrar el SVG si no ocupa el 100% del ancho disponible */
        }
        /* Colores para las zonas */
        .zona-escenario { fill: #f87171; } /* Rojo */
        .zona-informacion { fill: #60a5fa; } /* Azul */
        .zona-artistas { fill: #a78bfa; } /* Morado */
        .zona-talleres { fill: #4ade80; } /* Verde */
        
        /* Estilos para el texto dentro del SVG */
        .zona-texto {
            font-family: sans-serif;
            font-size: 20px;
            font-weight: bold;
            fill: #ffffff; /* Texto blanco para que contraste */
            text-anchor: middle; /* Centrar el texto horizontalmente */
            pointer-events: none; /* Asegura que el texto no interfiera con el click en la forma */
        }
    </style>
</head>
<body class="text-gray-800">
    <div class="max-w-md mx-auto p-4">
        <div class="mb-4">
            <div class="flex items-center">
                <img src="estrella-trans.png" alt="Logo La Comarcón" class="logo-img mr-4" /> 
                <h1 id="main-title" class="text-2xl font-bold mx-auto">Horario</h1> 
                <a href="#" id="nav-toggle-btn" class="ml-4">
                    <i class="fas fa-map-marked-alt nav-icon"></i>
                </a>
            </div>
            <p class="text-sm text-gray-200 text-center mt-1">Torrevieja · 2025</p>
        </div>

        <div id="horario-container">
            <div class="flex justify-center mb-4">
                <button id="dia1Btn" class="px-4 py-2 bg-blue-500 text-white rounded-l-lg">Sábado</button>
                <button id="dia2Btn" class="px-4 py-2 bg-blue-100 text-blue-700 rounded-r-lg">Domingo</button>
            </div>

            <div class="flex overflow-x-auto mb-4 space-x-2">
                <button onclick="setFiltro('todas')" class="filtro-btn px-3 py-1 rounded-lg bg-gray-200 text-gray-800">Todas</button>
                <button onclick="setFiltro('favoritos')" class="filtro-btn px-3 py-1 rounded-lg bg-yellow-200 text-yellow-800">⭐ Favoritos</button>
                <button onclick="setFiltro('rol_mesa')" class="filtro-btn px-3 py-1 rounded-lg bg-purple-100 text-purple-700">Rol de mesa</button>
                <button onclick="setFiltro('rol_vivo')" class="filtro-btn px-3 py-1 rounded-lg bg-pink-100 text-pink-700">Rol en vivo</button>
                <button onclick="setFiltro('videojuegos')" class="filtro-btn px-3 py-1 rounded-lg bg-blue-100 text-blue-700">Videojuegos</button>
                <button onclick="setFiltro('juegos_mesa')" class="filtro-btn px-3 py-1 rounded-lg bg-indigo-100 text-indigo-700">Juegos de mesa</button>
                <button onclick="setFiltro('deportes')" class="filtro-btn px-3 py-1 rounded-lg bg-yellow-100 text-yellow-700">Deportes</button>
                <button onclick="setFiltro('concursos')" class="filtro-btn px-3 py-1 rounded-lg bg-red-100 text-red-700">Concursos</button>
                <button onclick="setFiltro('talleres')" class="filtro-btn px-3 py-1 rounded-lg bg-green-100 text-green-700">Talleres</button>
                <button onclick="setFiltro('charlas')" class="filtro-btn px-3 py-1 rounded-lg bg-orange-100 text-orange-700">Charlas</button>
                <button onclick="setFiltro('otros')" class="filtro-btn px-3 py-1 rounded-lg bg-gray-300 text-gray-800">Otros</button>
            </div>

            <div id="horario" class="space-y-4"></div>
        </div>

        <div id="mapa-container">
            <h2 class="text-xl font-bold mb-4">Mapa del Evento</h2>
            <svg id="evento-mapa-svg" viewBox="0 0 800 600" preserveAspectRatio="xMidYMid meet">
                <style>
                    /* Estilos para las formas y texto dentro del SVG */
                    rect {
                        stroke: #333;
                        stroke-width: 3;
                        transition: fill 0.3s ease; /* Transición suave al pasar el ratón */
                    }
                    rect:hover {
                        fill-opacity: 0.8;
                        cursor: pointer;
                    }
                    text {
                        font-family: Arial, sans-serif;
                        font-size: 28px;
                        font-weight: bold;
                        fill: #ffffff;
                        text-anchor: middle;
                        pointer-events: none; /* Asegura que el texto no bloquee el clic en la forma */
                    }
                    /* Colores de las zonas */
                    .zona-escenario { fill: #f87171; } /* Tailwind Red-400 */
                    .zona-informacion { fill: #60a5fa; } /* Tailwind Blue-400 */
                    .zona-artistas { fill: #a78bfa; } /* Tailwind Purple-400 */
                    .zona-talleres { fill: #4ade80; } /* Tailwind Green-400 */
                </style>

                <rect x="0" y="0" width="800" height="600" fill="#f0f0f0"/> 

                <rect x="50" y="50" width="300" height="150" class="zona-escenario" id="zonaEscenario" />
                <text x="200" y="130">ESCENARIO</text>

                <rect x="50" y="250" width="300" height="150" class="zona-informacion" id="zonaInformacion" />
                <text x="200" y="330">INFORMACIÓN</text>

                <rect x="450" y="50" width="300" height="150" class="zona-artistas" id="zonaArtistas" />
                <text x="600" y="130">ARTISTAS</text>

                <rect x="450" y="250" width="300" height="150" class="zona-talleres" id="zonaTalleres" />
                <text x="600" y="330">TALLERES</text>

                <line x1="350" y1="125" x2="450" y2="125" stroke="#666" stroke-width="5" stroke-linecap="round"/>
                <line x1="350" y1="325" x2="450" y2="325" stroke="#666" stroke-width="5" stroke-linecap="round"/>
                <line x1="200" y1="200" x2="200" y2="250" stroke="#666" stroke-width="5" stroke-linecap="round"/>
                <line x1="600" y1="200" x2="600" y2="250" stroke="#666" stroke-width="5" stroke-linecap="round"/>

                <circle cx="400" cy="500" r="30" fill="#ffcc00" stroke="#333" stroke-width="2" />
                <text x="400" y="508" font-size="24" fill="#333">ENTRADA</text>

            </svg>
            <p class="mt-4 text-sm text-gray-600">Puedes usar el zoom de tu navegador (Ctrl/Cmd + Rueda del ratón) para ver los detalles del mapa.</p>
        </div>
    </div>

    <script>
        let actividades = { sabado: [], domingo: [] };
        let diaActual = "sabado";
        let filtroActual = "todas";
        let favoritos = new Set(JSON.parse(localStorage.getItem('horarioFavoritos')) || []);
        let actividadAbierta = null; 

        // Elementos principales de la UI
        const mainTitle = document.getElementById('main-title');
        const navToggleButton = document.getElementById('nav-toggle-btn');
        const navToggleIcon = navToggleButton.querySelector('i');
        const horarioContainer = document.getElementById('horario-container');
        const mapaContainer = document.getElementById('mapa-container'); // Referencia al nuevo contenedor del mapa

        // Estado actual: 'horario' o 'mapa'
        let currentView = 'horario'; 

        const URL_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQVrAqpQlI4uhoa45UBxoRxsrnUB54QJ_LR5WgScbfFEGwkUannAa-0jRONdjsOwRoJ2hYNbMMAqcw-/pub?output=csv";

        function agruparPorHora(lista) {
            const mapa = {};
            lista.forEach(act => {
                if (filtroActual === "favoritos" && !favoritos.has(act.id)) return;
                if (filtroActual !== "todas" && filtroActual !== "favoritos" && act.tipo !== filtroActual) return;
                if (!mapa[act.hora]) mapa[act.hora] = [];
                mapa[act.hora].push(act);
            });
            return mapa;
        }

        function renderHorario() {
            const contenedor = document.getElementById("horario");
            contenedor.innerHTML = "";
            const actividadesPorHora = agruparPorHora(actividades[diaActual]);
            const horas = Object.keys(actividadesPorHora).sort();

            actividadAbierta = null; 

            if (horas.length === 0) {
                contenedor.innerHTML = "<p class='text-center text-gray-300'>No hay actividades para esta selección.</p>";
                return;
            }

            horas.forEach(hora => {
                const bloque = document.createElement("div");
                bloque.innerHTML = `<h3 class="text-sm font-semibold text-gray-200 mb-2">🕒 ${hora}</h3>`;
                actividadesPorHora[hora].forEach(act => {
                    const card = document.createElement("div");
                    card.className = "bg-white p-4 mb-2 rounded shadow flex justify-between items-center actividad";
                    card.dataset.id = act.id; 

                    const isFavoriteClass = favoritos.has(act.id) ? 'is-favorite' : '';
                    const starIconClass = favoritos.has(act.id) ? 'fas' : 'far';

                    card.innerHTML = `
                        <div>
                            <h2 class="text-lg font-bold">${act.titulo}</h2>
                            <span class="inline-block mt-1 px-2 py-1 text-xs rounded-full ${getColor(act.tipo)}">${formateaCategoria(act.tipo)}</span>
                            <div class="detalle-actividad">
                                ${act.detalle || 'No hay información adicional.'}
                                ${act.enlace ? `<div class="mt-2"><a href="${act.enlace}" target="_blank" class="text-blue-600 underline font-semibold">Apuntarse / Más info</a></div>` : ''}
                            </div>
                        </div>
                        <div class="flex items-center">
                            <div class="text-sm text-gray-500 ml-4 whitespace-nowrap mr-2">⏱ ${act.duracion}</div>
                            <span class="favorite-btn ${isFavoriteClass}" data-id="${act.id}">
                                <i class="${starIconClass} fa-star"></i>
                            </span>
                        </div>
                    `;
                    card.addEventListener('click', (e) => {
                        if (e.target.closest('.favorite-btn')) return;

                        const detalle = card.querySelector('.detalle-actividad');
                        
                        if (actividadAbierta && actividadAbierta !== card) {
                            actividadAbierta.querySelector('.detalle-actividad').style.display = 'none';
                        }

                        detalle.style.display = (detalle.style.display === 'block') ? 'none' : 'block';
                        
                        actividadAbierta = (detalle.style.display === 'block') ? card : null;
                    });
                    bloque.appendChild(card);
                });
                contenedor.appendChild(bloque);
            });

            document.querySelectorAll('.favorite-btn').forEach(button => {
                button.addEventListener('click', toggleFavorite);
            });
        }

        function formateaCategoria(tipo) {
            const mapa = {
                rol_mesa: "Rol de mesa", rol_vivo: "Rol en vivo", videojuegos: "Videojuegos",
                juegos_mesa: "Juegos de mesa", deportes: "Deportes", concursos: "Concursos",
                talleres: "Talleres", charlas: "Charlas", otros: "Otros", favoritos: "Favoritos"
            };
            return mapa[tipo] || tipo;
        }

        function getColor(tipo) {
            switch (tipo) {
                case "rol_mesa": return "bg-purple-100 text-purple-700";
                case "rol_vivo": return "bg-pink-100 text-pink-700";
                case "videojuegos": return "bg-blue-100 text-blue-700";
                case "juegos_mesa": return "bg-indigo-100 text-indigo-700";
                case "deportes": return "bg-yellow-100 text-yellow-700";
                case "concursos": return "bg-red-100 text-red-700";
                case "talleres": return "bg-green-100 text-green-700";
                case "charlas": return "bg-orange-100 text-orange-700";
                case "otros": return "bg-gray-200 text-gray-800";
                default: return "bg-gray-100 text-gray-700";
            }
        }

        function toggleFavorite(event) {
            const button = event.currentTarget;
            const icon = button.querySelector('i');
            const id = button.dataset.id;
            if (favoritos.has(id)) {
                favoritos.delete(id);
                button.classList.remove('is-favorite');
                icon.classList.remove('fas');
                icon.classList.add('far');
            } else {
                favoritos.add(id);
                button.classList.add('is-favorite');
                icon.classList.remove('far');
                icon.classList.add('fas');
            }
            localStorage.setItem('horarioFavoritos', JSON.stringify(Array.from(favoritos)));
            if (filtroActual === "favoritos") renderHorario();
        }

        function setFiltro(filtro) {
            filtroActual = filtro;
            document.querySelectorAll(".filtro-btn").forEach(btn => {
                btn.classList.remove("ring", "ring-offset-2", "ring-blue-500");
            });
            const btnActivo = Array.from(document.querySelectorAll(".filtro-btn"))
                .find(btn => btn.textContent.toLowerCase().includes(formateaCategoria(filtro).toLowerCase()));
            if (btnActivo) btnActivo.classList.add("ring", "ring-offset-2", "ring-blue-500");
            renderHorario();
        }

        function parseCSV(text) {
            const lines = text.trim().split("\n");
            const headers = lines[0].split(",").map(h => h.trim());
            return lines.slice(1).map(row => {
                const values = row.split(",").map(c => c.trim());
                const obj = {};
                headers.forEach((h, i) => obj[h] = values[i]);
                return obj;
            });
        }

        function cargarDesdeCSV() {
            fetch(URL_CSV)
                .then(resp => resp.text())
                .then(data => {
                    const registros = parseCSV(data);
                    actividades = { sabado: [], domingo: [] };
                    registros.forEach(r => {
                        if (r["id"] && r["hora"] && r["titulo"] && r["tipo"] && r["duracion"] && r["dia"]) {
                            const actividad = {
                                id: r["id"].trim(),
                                hora: r["hora"].trim(),
                                titulo: r["titulo"].trim(),
                                tipo: r["tipo"].toLowerCase().trim(),
                                duracion: r["duracion"].trim(),
                                detalle: r["detalle"]?.trim() || "",
                                enlace: r["enlace"]?.trim() || ""
                            };
                            const dia = r["dia"].toLowerCase();
                            if (dia.includes("sab")) actividades.sabado.push(actividad);
                            else if (dia.includes("dom")) actividades.domingo.push(actividad);
                        }
                    });
                    renderHorario();
                });
        }

        // Función para cambiar entre Horario y Mapa
        function toggleView() {
            if (currentView === 'horario') {
                // Cambiar a vista de mapa
                horarioContainer.style.display = 'none';
                mapaContainer.style.display = 'block'; // Cambiado a 'block' para el SVG
                mainTitle.textContent = 'MAPA';
                navToggleIcon.classList.remove('fa-map-marked-alt');
                navToggleIcon.classList.add('fa-calendar-alt'); // Icono de calendario
                currentView = 'mapa';
            } else {
                // Cambiar a vista de horario
                mapaContainer.style.display = 'none';
                horarioContainer.style.display = 'block'; 
                mainTitle.textContent = 'Horario';
                navToggleIcon.classList.remove('fa-calendar-alt');
                navToggleIcon.classList.add('fa-map-marked-alt'); // Icono de mapa
                currentView = 'horario';
            }
        }

        // Event Listeners para los botones de día (si estamos en horario)
        document.getElementById("dia1Btn").addEventListener("click", () => {
            if (currentView === 'horario') { // Solo si estamos en la vista de horario
                diaActual = "sabado";
                document.getElementById("dia1Btn").classList.add("bg-blue-500", "text-white");
                document.getElementById("dia1Btn").classList.remove("bg-blue-100", "text-blue-700");
                document.getElementById("dia2Btn").classList.remove("bg-blue-500", "text-white");
                document.getElementById("dia2Btn").classList.add("bg-blue-100", "text-blue-700");
                renderHorario();
            }
        });

        document.getElementById("dia2Btn").addEventListener("click", () => {
            if (currentView === 'horario') { // Solo si estamos en la vista de horario
                diaActual = "domingo";
                document.getElementById("dia2Btn").classList.add("bg-blue-500", "text-white");
                document.getElementById("dia2Btn").classList.remove("bg-blue-100", "text-blue-700");
                document.getElementById("dia1Btn").classList.remove("bg-blue-500", "text-white");
                document.getElementById("dia1Btn").classList.add("bg-blue-100", "text-blue-700");
                renderHorario();
            }
        });
        
        // Listener para el botón de alternar vista
        navToggleButton.addEventListener('click', (e) => {
            e.preventDefault(); // Prevenir el comportamiento por defecto del enlace
            toggleView();
        });

        // Cargar datos al inicio
        cargarDesdeCSV();
    </script>
</body>
</html>
